<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Skill Exchange Dashboard</title>
  <style>
    /* ==== GLOBAL STYLES ==== */
    *{
      margin:0;
      padding:0;
      box-sizing:border-box;
      font-family:'Segoe UI',sans-serif;
    }
    body{
      min-height:100vh;
      background:linear-gradient(-45deg,#ff6a00,#ee0979,#00c6ff,#8e2de2);
      background-size:400% 400%;
      animation:bgAnim 20s ease infinite;
      display:flex;
      justify-content:center;
      align-items:center;
      transition:0.3s;
      color:#fff;
    }
    body.light-mode{
      background:linear-gradient(-45deg,#a1c4fd,#c2e9fb,#f6d365,#fda085);
      color:#111;
    }
    @keyframes bgAnim{
      0%{background-position:0% 50%;}
      25%{background-position:50% 100%;}
      50%{background-position:100% 50%;}
      75%{background-position:50% 0%;}
      100%{background-position:0% 50%;}
    }
    .hidden{display:none;}

    /* ==== AUTH CONTAINERS ==== */
    .auth-container{
      width:380px;
      max-width:90%;
      padding:35px;
      border-radius:20px;
      background:rgba(255,255,255,0.2);
      backdrop-filter:blur(15px);
      box-shadow:0 30px 60px rgba(0,0,0,0.35);
      animation:slideIn 0.8s ease;
      text-align:center;
    }
    .auth-container:hover{transform:scale(1.02);}
    @keyframes slideIn{
      from{opacity:0; transform:translateY(50px);}
      to{opacity:1; transform:translateY(0);}
    }
    .auth-container h2{
      text-align:center;
      color:#fff;
      margin-bottom:25px;
      font-size:1.6rem;
    }
    .auth-container input{
      width:100%;
      padding:12px;
      margin-top:12px;
      border-radius:10px;
      border:none;
      outline:none;
      background:rgba(255,255,255,.3);
      color:#fff;
      font-size:14px;
    }
    .auth-container input::placeholder{
        color:#e5e7eb;
    }
    .auth-container input:focus{
        background:rgba(255,255,255,.45);
    }
    .auth-container button{
      width:100%;
      padding:13px;
      margin-top:22px;
      border:none;
      border-radius:12px;
      background:linear-gradient(135deg,#00ffe5,#00c6ff);
      color:#fff;
      font-size:15px;
      font-weight:bold;
      cursor:pointer;
      transition:0.3s;
    }
    .auth-container button:hover{
      transform:scale(1.03);
      box-shadow:0 12px 35px rgba(0,198,255,.9);
    }
    .link{
      text-align:center;
      color:#fff;
      margin-top:18px;
    }
    .link span{
      color:#00e5ff;
      cursor:pointer;
      font-weight:600;
    }
    .link span:hover{text-decoration:underline;}

    /* ==== DASHBOARD ==== */
    .dashboard{
      display:none;
      min-height:100vh;
      padding:20px;
      width:90%;
      max-width:1100px;
      transition:0.3s;
    }
    .dashboard header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:25px;
    }
    .dashboard header h1{font-size:1.8rem;}

    /* fancy TOGGLE button */
    .mode-toggle{
      position:relative;
      padding:8px 18px;
      border-radius:999px;
      cursor:pointer;
      font-size:13px;
      font-weight:600;
      color:#fff;
      background:rgba(255,255,255,0.15);
      border:1px solid rgba(255,255,255,0.4);
      box-shadow:0 6px 18px rgba(0,0,0,0.45);
      backdrop-filter:blur(10px);
      overflow:hidden;
      transition:
        transform 0.2s ease,
        box-shadow 0.2s ease,
        background 0.25s ease,
        border-color 0.25s ease;
    }
    .mode-toggle::before{
      content:"";
      position:absolute;
      inset:0;
      background:radial-gradient(circle at 0 0,rgba(255,255,255,0.6),transparent 55%);
      opacity:0;
      transition:opacity 0.3s ease;
    }
    .mode-toggle:hover{
      transform:translateY(-2px) scale(1.03);
      box-shadow:0 12px 28px rgba(0,0,0,0.6);
      background:rgba(255,255,255,0.25);
      border-color:rgba(255,255,255,0.9);
    }
    .mode-toggle:hover::before{
      opacity:1;
    }
    .mode-toggle:active{
      transform:translateY(1px) scale(0.98);
      box-shadow:0 6px 16px rgba(0,0,0,0.5);
    }

    /* attractive LOGOUT button */
    .logout-btn{
      position:relative;
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:8px 22px;
      border:none;
      border-radius:999px;
      cursor:pointer;
      font-size:13px;
      font-weight:600;
      color:#fff;
      background:linear-gradient(135deg,#ff4b2b,#ff416c,#ff6a00);
      background-size:200% 200%;
      box-shadow:0 10px 25px rgba(0,0,0,0.55);
      backdrop-filter:blur(12px);
      overflow:hidden;
      transition:
        background-position 0.4s ease,
        transform 0.2s ease,
        box-shadow 0.2s ease;
    }
    .logout-btn::before{
      content:"";
      position:absolute;
      top:0;
      left:-120%;
      width:50%;
      height:100%;
      background:linear-gradient(120deg,rgba(255,255,255,0.9),transparent);
      transform:skewX(-25deg);
      opacity:0.8;
      transition:left 0.5s ease;
    }
    .logout-btn:hover{
      background-position:100% 0;
      transform:translateY(-2px) scale(1.04);
      box-shadow:0 16px 35px rgba(0,0,0,0.7);
    }
    .logout-btn:hover::before{
      left:140%;
    }
    .logout-btn:active{
      transform:translateY(1px) scale(0.98);
      box-shadow:0 8px 18px rgba(0,0,0,0.6);
    }
    .logout-icon{
      font-size:15px;
    }
    .logout-text{
      letter-spacing:0.6px;
      text-transform:uppercase;
    }

    /* sections */
    .sections-wrapper{
      display:block;
      margin-top:10px;
    }
    .section{
      background:rgba(0,0,0,0.35);
      backdrop-filter:blur(8px);
      border-radius:15px;
      padding:15px;
      margin-bottom:20px;
      transition:0.3s;
    }
    .section h3{margin-bottom:10px;}
    .section button{
      margin-top:10px;
      background:#00c6ff;
      color:#000;
      padding:8px 12px;
      border:none;
      border-radius:8px;
      cursor:pointer;
      font-size:13px;
    }
    .section button:hover{background:#00ffe5;}
    ul{list-style:none; padding-left:0;}
    li{
      padding:5px 0;
      border-bottom:1px solid rgba(255,255,255,0.3);
      font-size:13px;
    }

    /* inputs and dropdowns */
    .section input,
    .section select,
    .section textarea{
      display:block;
      width:100%;
      padding:8px;
      margin-top:8px;
      margin-bottom:4px;
      border-radius:8px;
      border:none;
      outline:none;
      background:#222;
      color:#fff;
      font-size:13px;
    }
    .section textarea{
      resize:vertical;
      min-height:60px;
    }
    body.light-mode .section input,
    body.light-mode .section select,
    body.light-mode .section textarea{
      background:#ffffff;
      color:#111;
    }

    .section select option{
      background:#111;
      color:#fff;
    }
    body.light-mode .section select option{
      background:#fff;
      color:#111;
    }

    .inline-btn{
      display:inline-block;
      margin-left:5px;
      font-size:11px;
      padding:3px 6px;
    }

    body.light-mode .dashboard .section{
      background:rgba(255,255,255,0.25);
      color:#111;
    }

    /* stars in review box */
    #starRow{
      margin:6px 0 4px;
    }
    .star{
      font-size:22px;
      cursor:pointer;
      color:#555;           /* empty star */
      margin-right:2px;
    }
    .star.active{
      color:#ffd700;        /* filled star */
      text-shadow:0 0 6px rgba(255,215,0,0.8);
    }
    #starText{
      margin-left:8px;
      font-size:13px;
    }
  </style>
</head>
<body class="dark-mode">

<!-- LOGIN -->
<div class="auth-container" id="loginBox">
  <h2>LOGIN</h2>
  <input type="email" id="loginEmail" placeholder="Email">
  <input type="password" id="loginPass" placeholder="Password">
  <button onclick="login()">Login</button>
  <div class="link">
    <span onclick="openSignup()">Create Account</span> |
    <span onclick="openForgot()">Forgot Password?</span>
  </div>
</div>

<!-- SIGNUP -->
<div class="auth-container hidden" id="signupBox">
  <h2>SIGN UP</h2>
  <input type="email" id="signupEmail" placeholder="Email">
  <input type="password" id="signupPass" placeholder="Password">
  <button onclick="signup()">Create Account</button>
  <div class="link"><span onclick="openLogin()">Back to Login</span></div>
</div>

<!-- FORGOT -->
<div class="auth-container hidden" id="forgotBox">
  <h2>RESET PASSWORD</h2>
  <input type="email" id="forgotEmail" placeholder="Email">
  <input type="password" id="newPass" placeholder="New Password">
  <input type="password" id="rePass" placeholder="Confirm Password">
  <button onclick="resetPass()">Update</button>
  <div class="link"><span onclick="openLogin()">Back to Login</span></div>
</div>

<!-- DASHBOARD / HOME -->
<div class="dashboard" id="dashboard" aria-label="Skill Exchange Dashboard">
  <header>
    <h1>Skill Exchange Dashboard</h1>
    <div style="display:flex;gap:10px;align-items:center;">
      <div class="mode-toggle" onclick="toggleDarkMode()" aria-label="Toggle dark or light mode">
        üåì
      </div>
      <button class="logout-btn" onclick="logout()">
        <span class="logout-icon">‚èª</span>
        <span class="logout-text">Logout</span>
      </button>
    </div>
  </header>

  <div class="sections-wrapper">

    <div class="section" id="notificationsSection">
      <h3>Notifications</h3>
      <ul id="notificationsList"></ul>
    </div>

    <div class="section" id="skillsSection">
      <h3>My Skills</h3>
      <ul id="skillsList"></ul>

      <input type="text" id="newSkill" placeholder="Skill name">
      <select id="category">
        <option value="Coding">Coding</option>
        <option value="Cooking">Cooking</option>
        <option value="Fitness">Fitness</option>
        <option value="Music">Music</option>
      </select>
      <select id="level">
        <option value="Beginner">Beginner</option>
        <option value="Intermediate">Intermediate</option>
        <option value="Expert">Expert</option>
      </select>
      <select id="availability">
        <option value="Weekdays">Weekdays</option>
        <option value="Weekends">Weekends</option>
        <option value="Flexible">Flexible</option>
      </select>
      <button onclick="addSkill()">Add Skill</button>
    </div>

    <div class="section" id="searchSection">
      <h3>Search Skills</h3>
      <input type="text" id="searchSkill" placeholder="Search skills" oninput="autocompleteSearch()">
      <select id="filterCategory">
        <option value="">All Categories</option>
        <option value="Coding">Coding</option>
        <option value="Cooking">Cooking</option>
        <option value="Fitness">Fitness</option>
        <option value="Music">Music</option>
      </select>
      <select id="filterLevel">
        <option value="">All Levels</option>
        <option value="Beginner">Beginner</option>
        <option value="Intermediate">Intermediate</option>
        <option value="Expert">Expert</option>
      </select>
      <button onclick="searchSkillFunc()">Search</button>

      <ul id="searchSuggestions"></ul>
      <ul id="searchResults"></ul>
    </div>

    <div class="section" id="requestsSection">
      <h3>Skill Exchange Requests</h3>
      <button onclick="openRequestModal()">Send Request</button>
      <ul id="requestsList"></ul>
    </div>

    <!-- Ratings & Reviews with star rating -->
    <div class="section" id="ratingsSection">
      <h3>Ratings & Reviews</h3>

      <div id="reviewFormBox">
        <input type="email" id="reviewTo" placeholder="User email (to)">
        <input type="text" id="reviewSkill" placeholder="Skill name">
        <div id="starRow">
          <span class="star" data-value="1">‚òÖ</span>
          <span class="star" data-value="2">‚òÖ</span>
          <span class="star" data-value="3">‚òÖ</span>
          <span class="star" data-value="4">‚òÖ</span>
          <span class="star" data-value="5">‚òÖ</span>
          <span id="starText">Rating: 0 / 5</span>
        </div>
        <textarea id="reviewComment" placeholder="Comment"></textarea>
        <button onclick="submitReview()">Submit Review</button>
      </div>

      <ul id="reviewsList"></ul>
    </div>

    <!-- LocalStorage Info -->
    <div class="section" id="storageInfoSection">
      <h3>LocalStorage Info</h3>
      <p id="storageSummary"></p>
      <ul id="storageKeysList"></ul>
    </div>

    <div class="section" id="messagingSection">
      <h3>Messaging & Calls</h3>
      <p style="font-size:13px;">
        Real-time chat, file sharing, and voice/video calls can be added later using Socket.io and WebRTC.
      </p>
    </div>

    <div class="section" id="aiTestSection">
      <h3>AI Skill Verification Test</h3>
      <button onclick="startAISkillTest()">Start Test</button>
      <div id="aiTestResult" style="margin-top:10px;font-size:13px;"></div>
    </div>

  </div>
</div>

<script>
  const loginBox = document.getElementById("loginBox");
  const signupBox = document.getElementById("signupBox");
  const forgotBox = document.getElementById("forgotBox");
  const dashboard = document.getElementById("dashboard");

  let currentStarRating = 0;

  function openSignup(){
    loginBox.classList.add("hidden");
    signupBox.classList.remove("hidden");
    forgotBox.classList.add("hidden");
  }
  function openLogin(){
    signupBox.classList.add("hidden");
    forgotBox.classList.add("hidden");
    loginBox.classList.remove("hidden");
  }
  function openForgot(){
    loginBox.classList.add("hidden");
    signupBox.classList.add("hidden");
    forgotBox.classList.remove("hidden");
  }

  function signup(){
    const e = signupEmail.value.trim();
    const p = signupPass.value.trim();
    if(!e || !p){ alert("Enter email and password"); return; }
    if(p.length < 8){ alert("Password min 8 chars"); return; }
    if(localStorage.getItem(e)){
      alert("User already exists");
      return;
    }
    const userObj = {
      password: p,
      skills: [],
      requests: [],
      notifications: [],
      reviews: [] // {from,to,skill,rating,comment}
    };
    localStorage.setItem(e, JSON.stringify(userObj));
    alert("Account created");
    openLogin();
  }

  function login(){
    const email = loginEmail.value.trim();
    const pass = loginPass.value.trim();
    const user = JSON.parse(localStorage.getItem(email));
    if(user && user.password === pass){
      localStorage.setItem("currentUser", email);
      alert("Login successful");
      loginBox.classList.add("hidden");
      signupBox.classList.add("hidden");
      forgotBox.classList.add("hidden");
      dashboard.style.display = "block";
      loadDashboard(user);
      setupStarRating();
    }else{
      alert("Invalid credentials");
    }
  }

  function resetPass(){
    const email = forgotEmail.value.trim();
    const newP = newPass.value.trim();
    const reP = rePass.value.trim();
    let user = JSON.parse(localStorage.getItem(email));
    if(!user){
      alert("User not found");
      return;
    }
    if(newP.length < 8){
      alert("Password min 8 chars");
      return;
    }
    if(newP !== reP){
      alert("Passwords do not match");
      return;
    }
    user.password = newP;
    localStorage.setItem(email, JSON.stringify(user));
    alert("Password updated");
    openLogin();
  }

  function logout(){
    localStorage.removeItem("currentUser");
    dashboard.style.display = "none";
    loginBox.classList.remove("hidden");
  }

  function applyThemeFromStorage(){
    const theme = localStorage.getItem("theme");
    if(theme === "light"){
      document.body.classList.remove('dark-mode');
      document.body.classList.add('light-mode');
    }else{
      document.body.classList.remove('light-mode');
      document.body.classList.add('dark-mode');
    }
  }

  function toggleDarkMode(){
    if(document.body.classList.contains('dark-mode')){
      document.body.classList.remove('dark-mode');
      document.body.classList.add('light-mode');
      localStorage.setItem("theme","light");
    }else{
      document.body.classList.remove('light-mode');
      document.body.classList.add('dark-mode');
      localStorage.setItem("theme","dark");
    }
  }

  function getCurrentUserObj(){
    const email = localStorage.getItem("currentUser");
    if(!email) return null;
    const user = JSON.parse(localStorage.getItem(email));
    return { email, user };
  }

  function saveUser(email,user){
    localStorage.setItem(email, JSON.stringify(user));
  }

  function loadDashboard(user){
    loadSkills(user);
    loadRequests(user);
    loadNotifications(user);
    loadReviews(user);
    showStorageInfo();
  }

  /* SKILLS CRUD */
  function loadSkills(user){
    const skillsList = document.getElementById("skillsList");
    skillsList.innerHTML = '';
    (user.skills || []).forEach((s,index) => {
      const li = document.createElement('li');
      li.innerHTML = `
        ${s.name} (${s.category}) - ${s.level} | ${s.availability}
        <button class="inline-btn" onclick="editSkill(${index})">Edit</button>
        <button class="inline-btn" onclick="deleteSkill(${index})">Delete</button>
      `;
      skillsList.appendChild(li);
    });
  }

  function addSkill(){
    const name = document.getElementById("newSkill").value.trim();
    const category = document.getElementById("category").value;
    const level = document.getElementById("level").value;
    const availability = document.getElementById("availability").value;
    if(!name) return;
    const data = getCurrentUserObj();
    if(!data) return;
    const { email, user } = data;
    user.skills.push({ name, category, level, availability });
    saveUser(email,user);
    document.getElementById("newSkill").value = '';
    loadDashboard(user);
  }

  function deleteSkill(index){
    const data = getCurrentUserObj();
    if(!data) return;
    const { email, user } = data;
    user.skills.splice(index,1);
    saveUser(email,user);
    loadDashboard(user);
  }

  function editSkill(index){
    const data = getCurrentUserObj();
    if(!data) return;
    const { email, user } = data;
    const s = user.skills[index];
    const newName = prompt("Skill name:", s.name);
    if(newName && newName.trim()){
      s.name = newName.trim();
      user.skills[index] = s;
      saveUser(email,user);
      loadDashboard(user);
    }
  }

  /* SEARCH */
  function autocompleteSearch(){
    const query = document.getElementById("searchSkill").value.toLowerCase();
    const suggestions = document.getElementById("searchSuggestions");
    suggestions.innerHTML = '';
    if(!query) return;
    const seen = new Set();
    for(let i=0;i<localStorage.length;i++){
      const key = localStorage.key(i);
      if(key === "currentUser" || key === "theme") continue;
      const u = JSON.parse(localStorage.getItem(key));
      if(!u || !u.skills) continue;
      u.skills.forEach(skill => {
        const label = skill.name || skill;
        if(label.toLowerCase().includes(query) && !seen.has(label)){
          seen.add(label);
          const li = document.createElement('li');
          li.textContent = label;
          li.onclick = () => {
            document.getElementById("searchSkill").value = label;
            suggestions.innerHTML = '';
          };
          suggestions.appendChild(li);
        }
      });
    }
  }

  function searchSkillFunc(){
    const query = document.getElementById("searchSkill").value.toLowerCase();
    const cat = document.getElementById("filterCategory").value;
    const level = document.getElementById("filterLevel").value;
    const results = document.getElementById("searchResults");
    results.innerHTML = '';

    for(let i=0;i<localStorage.length;i++){
      const email = localStorage.key(i);
      if(email === "currentUser" || email === "theme") continue;
      const u = JSON.parse(localStorage.getItem(email));
      if(!u || !u.skills) continue;
      u.skills.forEach(skill => {
        const matchesQuery = skill.name.toLowerCase().includes(query);
        const matchesCat = !cat || skill.category === cat;
        const matchesLevel = !level || skill.level === level;
        if(matchesQuery && matchesCat && matchesLevel){
          const li = document.createElement('li');
          li.textContent = `${email}: ${skill.name} (${skill.category}) - ${skill.level}`;
          results.appendChild(li);
        }
      });
    }
  }

  /* REQUESTS */
  function loadRequests(user){
    const list = document.getElementById("requestsList");
    list.innerHTML = '';
    (user.requests || []).forEach((r,idx) => {
      const me = localStorage.getItem("currentUser");
      const isReceiver = r.to === me;
      const li = document.createElement('li');
      li.innerHTML = `
        ${r.from} ‚Üí ${r.to} | ${r.skill} | ${r.dateTime} | Status: ${r.status}
        ${isReceiver && r.status === "Pending"
          ? `<button class="inline-btn" onclick="updateRequestStatus(${idx}, 'Accepted')">Accept</button>
             <button class="inline-btn" onclick="updateRequestStatus(${idx}, 'Cancelled')">Reject</button>`
          : ''
        }
      `;
      list.appendChild(li);
    });
  }

  function openRequestModal(){
    const to = prompt("Enter receiver email:");
    const skill = prompt("Skill you want to learn/teach:");
    const dateTime = prompt("Preferred date & time (e.g. 2025-12-20 18:00):");
    if(!to || !skill) return;
    const fromData = getCurrentUserObj();
    if(!fromData) return;
    const { email: fromEmail, user: fromUser } = fromData;

    const toUser = JSON.parse(localStorage.getItem(to));
    if(!toUser){
      alert("Receiver user not found");
      return;
    }

    const request = {
      from: fromEmail,
      to,
      skill,
      dateTime,
      status: "Pending"
    };

    fromUser.requests.push(request);
    saveUser(fromEmail,fromUser);

    toUser.requests.push(request);
    toUser.notifications = toUser.notifications || [];
    toUser.notifications.push(`New request from ${fromEmail} for ${skill} on ${dateTime}`);
    saveUser(to,toUser);

    alert("Request sent");
    loadDashboard(fromUser);
  }

  function updateRequestStatus(index,newStatus){
    const meEmail = localStorage.getItem("currentUser");
    const meUser = JSON.parse(localStorage.getItem(meEmail));
    const req = meUser.requests[index];
    if(!req) return;

    req.status = newStatus;
    meUser.requests[index] = req;
    saveUser(meEmail,meUser);

    const otherEmail = req.from === meEmail ? req.to : req.from;
    const otherUser = JSON.parse(localStorage.getItem(otherEmail));
    if(otherUser){
      const otherReq = (otherUser.requests || []).find(r =>
        r.from === req.from &&
        r.to === req.to &&
        r.skill === req.skill &&
        r.dateTime === req.dateTime
      );
      if(otherReq) otherReq.status = newStatus;
      otherUser.notifications = otherUser.notifications || [];
      otherUser.notifications.push(`Your request for ${req.skill} is now ${newStatus}`);
      saveUser(otherEmail,otherUser);
    }

    loadDashboard(meUser);
  }

  /* NOTIFICATIONS */
  function loadNotifications(user){
    const list = document.getElementById("notificationsList");
    list.innerHTML = '';
    (user.notifications || []).slice().reverse().forEach(n => {
      const li = document.createElement('li');
      li.textContent = n;
      list.appendChild(li);
    });
  }

  /* STAR RATING UI */
  function setupStarRating(){
    const stars = document.querySelectorAll("#starRow .star");
    stars.forEach(star => {
      star.addEventListener("click", () => {
        const value = parseInt(star.getAttribute("data-value"),10);
        currentStarRating = value;
        updateStarUI(value);
      });
    });
  }

  function updateStarUI(value){
    const stars = document.querySelectorAll("#starRow .star");
    stars.forEach(star => {
      const v = parseInt(star.getAttribute("data-value"),10);
      if(v <= value){
        star.classList.add("active");
      }else{
        star.classList.remove("active");
      }
    });
    document.getElementById("starText").textContent = `Rating: ${value} / 5`;
  }

  /* REVIEWS */
  function submitReview(){
    const to = document.getElementById("reviewTo").value.trim();
    const skill = document.getElementById("reviewSkill").value.trim();
    const comment = document.getElementById("reviewComment").value.trim();
    const rating = currentStarRating;

    if(!to || !skill || !rating){
      alert("Fill email, skill, and click stars for rating.");
      return;
    }
    if(rating < 1 || rating > 5){
      alert("Rating must be between 1 and 5");
      return;
    }

    const fromEmail = localStorage.getItem("currentUser");
    const reviewedUser = JSON.parse(localStorage.getItem(to));
    if(!reviewedUser){
      alert("User not found");
      return;
    }

    reviewedUser.reviews = reviewedUser.reviews || [];
    reviewedUser.reviews.push({ from: fromEmail, to, skill, rating, comment });
    saveUser(to,reviewedUser);
    alert("Review added");

    // reset form
    document.getElementById("reviewTo").value = "";
    document.getElementById("reviewSkill").value = "";
    document.getElementById("reviewComment").value = "";
    currentStarRating = 0;
    updateStarUI(0);

    // reload reviews for logged in user
    const me = getCurrentUserObj();
    if(me){
      loadDashboard(me.user);
    }
  }

  function loadReviews(user){
    const list = document.getElementById("reviewsList");
    list.innerHTML = '';
    (user.reviews || []).forEach(r => {
      const li = document.createElement('li');
      li.textContent = `${r.from} rated ${r.rating}/5 for ${r.skill}: ${r.comment}`;
      list.appendChild(li);
    });
  }

  /* LOCALSTORAGE INFO */
  function showStorageInfo(){
    const summary = document.getElementById("storageSummary");
    const list = document.getElementById("storageKeysList");
    if(!summary || !list) return;

    const totalKeys = localStorage.length;
    summary.textContent = `Total keys in localStorage: ${totalKeys}`;

    list.innerHTML = "";
    for(let i = 0; i < localStorage.length; i++){
      const key = localStorage.key(i);
      const value = localStorage.getItem(key) || "";
      const li = document.createElement("li");
      li.textContent = `${key} ‚Üí ${value.length} characters`;
      list.appendChild(li);
    }
  }

  /* AI TEST */
  function startAISkillTest(){
    const aiResult = document.getElementById("aiTestResult");
    const data = getCurrentUserObj();
    if(!data || !data.user.skills.length){
      aiResult.textContent = "Add at least one skill before running AI test.";
      return;
    }
    const mainSkill = data.user.skills[0].name;
    aiResult.textContent = `Generating questions for ${mainSkill}...`;
    setTimeout(() => {
      aiResult.textContent = `AI Skill Verification Completed for ${mainSkill}: PASS ‚úÖ (simulated)`;
    },2000);
  }

  window.addEventListener("load", () => {
    applyThemeFromStorage();
    const email = localStorage.getItem("currentUser");
    if(email){
      const user = JSON.parse(localStorage.getItem(email));
      if(user){
        loginBox.classList.add("hidden");
        signupBox.classList.add("hidden");
        forgotBox.classList.add("hidden");
        dashboard.style.display = "block";
        loadDashboard(user);
        setupStarRating();
      }
    }else{
      setupStarRating();
    }
  });
</script>
</body>
</html>